@{
    ViewData["Title"] = "Лента новостей";
}
@model News

@if (User.Identity.IsAuthenticated)
{
    <form style=" border: 1px solid black; background-color:cornsilk;" asp-controller="Home" asp-action="AddNewPost"
          method="post" enctype="multipart/form-data">
        <span style=" border: 1px solid black; background-color:grey;">Добавление новой записи</span>
        <div>
            <label>Введите текст</label>
            <div>
                <textarea asp-for="Text"> </textarea>
            </div>
        </div>
        <div>
            <div>
                <input id="imageDataName" disabled class="form-control col-3" />
                <label class="btn btn-primary" style="background-color:">
                    Обзор...<input type="file" style="display: none;" id="imageData"
                                   accept=".jpg,.jpeg,.png" name="imageData" onchange="onImageUpload()">
                </label>
            </div>       
            <label class="btn btn-primary" id="save_button" style="float:right">
                Отправить<input type="submit" style="display: none;" id="save_button" name="save_button" >
            </label>
        </div>
    </form>
}
<div class="card">
    @foreach (News post in ViewBag.Posts)
    {
    <div class="card-header bg-secondary" style=" border: 1px solid black; background-color:cornsilk;">
        @if (post.Author.Photo.HasValue && Guid.Empty != post.Author.Photo.Value)
        {
            <img src="@Url.Content(SurfingBlogRt.Helpers.ImageHelper.GetUrl(post.Author.Photo))" class="rounded-circle" width="30" height="30" />
        }
        else
        {
            <img src="~/img/defaultProfile.jpg" width="30" height="30" style="border-radius: 50%" />
        }

        <label>@post.Author.Nickname</label>
        <div>
            <label>@post.CreateDateLabel</label>
        </div>

    </div>
        <div class="card-body">
                <div class="card-text">
                    @if (!string.IsNullOrEmpty(post.Text))
                    {
                        <label>@post.Text</label>
                    }
                </div>    
                    @if (post.Image.HasValue && Guid.Empty != post.Image.Value)
                    {
                        var photoUrl = SurfingBlogRt.Helpers.ImageHelper.GetUrl(post.Image);
                        @if (photoUrl != null)
                        {
                            <img src="@Url.Content(photoUrl)" class="w-100 h-100" />
                        }
                    }
        </div>
        
    }
</div>

<script type="text/javascript">
    function onImageUpload() {
        if (document.getElementById("postText").value === ""
            && document.getElementById("imageData").value === "") {
            document.getElementById('save_button').disabled = true;
        } else {
            document.getElementById('save_button').disabled = false;
        }

        if (document.getElementById('imageData')
            && document.getElementById('imageData').files
            && document.getElementById('imageData').files[0].name !== "") {
            document.getElementById("imageDataName").value
                = "...\\" + document.getElementById('imageData').files[0].name;
        }
    }
</script>
